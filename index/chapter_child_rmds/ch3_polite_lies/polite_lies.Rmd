```{r, include=FALSE}
knitr::opts_chunk$set(echo = F, cache = T, warning=F, message=F, 
                      fig.width=4, fig.asp = 0.618, out.width = "90%", 
                      fig.align = 'center', fig.pos = 't')

library(here); library(tidyverse); library(ggthemes); library(langcog); library(brms); library(stringr); library(lme4); library(knitr)

source(here::here("index/disseration_helpers.R"))
child_lies_image_path <- "index/chapter_child_rmds/ch3_polite_lies/figs"
child_lies_file_path <- "index/chapter_child_rmds/ch3_polite_lies/files"
```

```{r child_inf_data}
d1 <- read.csv(here(child_lies_file_path, "trupol_data_all.csv"))
d_age <- read.csv(here(child_lies_file_path, "trupol_v2_subject_log.csv")) %>%
  select(subid, consent, english, age_exact, sex)
d1 <- left_join(d1, d_age) %>%
  filter(age == "adult" | site == "India" | consent == "Y") %>%
  filter(age == "adult" | site == "India" | english > 50)
  
d1$age <- as.factor(as.character(d1$age))
d1$order <- as.factor(as.character(d1$order))
d1$site <- as.factor(as.character(d1$site))
d1$polite <- as.factor(as.character(d1$polite))
d1$q_kind <- as.factor(as.character(d1$q_kind))
d1$cond <- as.factor(as.character(d1$cond))
d1$subid <- as.factor(as.character(d1$subid))
d1$answer <- as.factor(as.character(d1$answer))

d_orig <- d1 %>%
  mutate(cond = fct_recode(cond,
    "expt" = "exp"
  )) %>%
  mutate(trial = substr(q, 6, 6)) %>%
  mutate(sample = "original") %>%
  rename(speaker = polite, qkind = q_kind, agebin = age, age = age_exact) %>%
  mutate(qkind = fct_recode(qkind,
                            "mean" = "meanness",
                            "nice" = "niceness",
                            "truth" = "truth-telling")) %>%
  
  select(subid, site, sample, cond, age, sex, trial, qkind, speaker, answer, age, agebin)

d_raw <- read_csv(here(child_lies_file_path, "trupol_v3_data_reorg.csv"))

d_filter_by_practice <- d_raw %>%
  filter(practice1 == "Y", practice2 == "Y", practice3 == "Y",
         practice4 == "Y", practice5 == "Y", practice6 == "Y")

d_clean <- d_raw %>%
  filter(subid %in% d_filter_by_practice$subid) %>%
  select(-practice1, -practice2, -practice3, 
         -practice4, -practice5, -practice6) %>%
  gather(-order, -subid, key = trial, value = answer) %>%
  separate(trial, c("trial", "question"), extra="merge") %>%
  mutate(trial = substr(trial, 6, 6)) %>%
  mutate(question = case_when(
                               grepl("playWhy", question) ~ "Pwhy",
                               grepl("play", question) ~ "play",
                               TRUE ~ question
                               )
         )

order <- read_csv(here(child_lies_file_path, "trupol_v3_order.csv")) %>%
  mutate_if(is.numeric, as.character)

d_join1 <- left_join(d_clean %>% mutate_if(is.numeric, as.character), order)

log <- read_csv(here(child_lies_file_path, "trupol_v3_subject_log.csv")) %>%
  rename(subid = "Subject ID") %>%
  filter(Consent == "Y", English > 3, !grepl("pilot", Comments)) %>%
  select(subid, Age, Gender)

d_rep <- left_join(log, d_join1) %>%
  filter(!is.na(order)) %>%
  rename(age = Age, sex = Gender) %>%
  mutate(site = "US", sample = "replication") %>%
  mutate(qkind = case_when(
    !is.na(qkind) ~ qkind,
    TRUE ~ question
  )) %>%
  mutate(speaker = case_when(
    qkind == "play" | qkind == "Pwhy" ~ "NA",
    TRUE ~ speaker
  )) %>%
  mutate(agebin = case_when(
    age < 7 ~ "6",
    age >= 7 ~ "8"
  )) %>%
  mutate(answer = case_when(
    answer == "Y" ~ "1",
    answer == "N" ~ "0",
    TRUE ~ answer
  )) %>% 
  select(subid, site, sample, cond, age, sex, trial, qkind, speaker, answer, agebin)

d <- rbind(d_orig, d_rep) %>%
  mutate_if(is.character, as.factor)

d <- d %>%
  filter(site == "US")

```

## Introduction

Your friend gives a terrible presentation and asks for your opinion. Must you admit, “Your talk was terrible,” or is it acceptable to say: “Your talk was fine”? The latter is potentially misleading but gives the listener what she might want to hear—-in other words, it would be polite.

Politeness violates a critical principle of cooperative communication: exchanging information efficiently and accurately [@grice1975]. If information transfer was the only currency in communication, a cooperative speaker would find polite utterances undesirable because they are potentially misleading. People are polite, however, and speakers do produce polite utterances. 
Adults and children spontaneously produce requests in polite forms [@clark1980; @axia1985]. Speakers exhibit politeness strategies even while arguing, preventing unnecessary offense to their interactants [@holtgraves1997]. 
Listeners even attribute ambiguous speech to a polite desire to hide a truth that could hurt another’s self-image [e.g. @bonnefon2009]. 
In fact, it is difficult to imagine human speech that efficiently conveys only the truth. 
Intuitively, politeness is one prominent characteristic that differentiates human speech from stereotyped robotic communication, which may try to follow rules to say “please” or “thank you” yet still
lack genuine politeness.

Does this mean people are not cooperative communicators? 
@brown1987 recast the notion of a cooperative speaker as one who has both an informational goal to improve the listener’s knowledge state as well as a prosocial goal to minimize any potential damage to the hearer’s (and the speaker’s own) self-image, which they called *face.* 
In their analysis, if the speaker’s intended meaning contains no threat to the speaker or listener’s face, then the speaker will choose to convey the meaning in an efficient manner, putting it *on the record*. As the degree of face-threat becomes more severe, however, a speaker will choose to be polite by producing more indirect utterances.

One possible proposal based on this idea by @brown1987 is that people think about polite language as reflecting a tradeoff between information transfer and face-saving.
When you try to save face, you hide or you risk losing some information in your intended message by making your utterance false or indirect to some degree. 
When you prioritize truthfulness and informativity, you may risk losing listener’s (or your own) face.
In this Chapter, I'll examine whether and how children and adults may think about polite speech this way: 
Do they reason about polite speech as reflecting a tradeoff between the goals of information transfer and face-saving?

From very early on, children seem to understand that speakers want to be informative, and that they want to be prosocial.
Around one year of age, children already start to adjust their own informativeness in their communicative action depending on the listener needs [@liszkowski2008], and as they get older they correctly judge a speaker’s truthfulness and preferentially learn from informants who were previously accurate [@corriveau2009]. By 6 years they are able to readily judge whether teachers are being underinformative [@gweon2014].
Children also understand speakers' goals to be kind, as 3- to 4-year-olds reason that those who say "please" are nicer and more polite, and are likely to be better play partners [@yoon2019].

Do children think of the goals to be informative and to be kind as separate, fixed *rules* to follow, or do they make *inferences* that integrates and accounts for both goals that the speaker may consider?
One possibility is that children have a rule-based approach to language. 
They may think about deterministic rules such as "If you want something, then you should say *please*" and "If you see/feel/think *X*, then you should (truthfully) say *X.*"
Children can use these rules to both produce polite and truthful utterances themselves, and evaluate speakers based on whether they follow these rules or not ("She is nice because she said *please*"; or "She is bad/wrong because she said these cookies are yummy but they are really salty.")

Whereas these straightforward rules can make language production and understanding easy and productive, speakers often do not follow these rules deterministically. 
For example, people sometimes tell the truth ("Those herbs are poisonous, you shoudn't eat them") but at other times they tell lies to be kind ("This is a very delicious salad that you prepared!").
Indeed, caregivers contradict their own teachings as they demand children to tell the truth in some contexts ("Who broke the vase? Be honest."), but reproach them for telling the truth in other contexts (Child: "This [meal that Grandma cooked] is yucky" Father:"Don't say that, you should be nice!").
Thus, language users ultimately need to learn that language reflects not only simple deterministic rules to follow, but also more nuanced tradeoffs between different goals that speakers might have depending on the situation. 

Do adults and children go beyond simple rules and engage in an *inference*-based reasoning to think about how speech reflects speakers' different goals to be informative or to be prosocial? 
In this Chapter, I consider the case study of prosocial lies to examine whether children understand the tradeoff between speakers' informational goals and prosocial goals. 

First, do children *say* things that are truthful yet kind? From early on, children start producing prosocial lies. 
There is evidence that by 3 years, children start to tell white lies, and e.g., say that an adult “looks okay for the picture” even though she has a conspicuous mark of lipstick on her nose [@talwar2002], or lie to a gift-giver about her gift that they actually found undesirable [@talwar2007].

But do children *understand* that prosocial lies reflect speakers' priority to be prosocial over being truthful and informative? 
Children do seem to be sensitive to speakers' prosocial intentions: 
By 4 years, children evaluate lies differently depending on whether the lies were told to be kind to the listener (e.g., "Your new hat looks great") or to hide their own misdeed ["Yes, I brushed my teeth"], judging the latter to be worse [@bussey1999].
7- to 11-year-old children also tend to rate lie-telling more favorably in politeness situations (e.g. a teacher gave the protagonist an undesirable gift) than in transgression situations [e.g. the protagonist damaged a library book; @heyman2009]. 

It is an open question, however, whether children evaluate the exact same lie differently depending on the perceived goal tradeoff.
For example, saying "your cookies were tasty" may be an acceptable lie if the listener baked those cookies as a gift for the speaker, but the same lie might only be misleading and not helpful if the listener did not bake the cookies himself but simply wanted to taste the cookies. Likewise, telling the truth "the cookies were yucky" may seem blunt and harsh if the speaker is talking to the person who baked the cookies, but the same utterance can be reasonable and even helpful if the listener simply wants to taste the cookies and is curious how the speaker liked them.
In the current study, we ask whether children are able to reason about polite liars versus blunt truth-tellers, on the dimensions of information transfer (being honest) vs. face-saving (being nice/mean).

## Method

```{r childInfSample, results = 'asis'}
child_lies_tab1 <- d %>% 
  group_by(cond, sample, agebin, subid) %>%
  summarise(n=n()) %>%
  group_by(cond, sample, agebin) %>%
  summarise(n=n()) %>%
  mutate(n = as.character(round(n)))

child_lies_tab2 <- d %>% 
  distinct(cond, sample, agebin, age, subid) %>%
  group_by(cond, sample, agebin) %>%
  summarise(mean=round(mean(age),2), sd=round(sd(age, na.rm=T), 2))

child_lies_tab3 <- d %>%
  group_by(cond, sample, agebin, sex, subid) %>%
  summarise(n=n()) %>%
  group_by(cond, sample, agebin, sex) %>%
  summarise(n=n()) %>%
  filter(sex == "F") %>%
  select(-sex) %>%
  rename(Female = n)

child_lies_tab <- left_join(child_lies_tab1, child_lies_tab3) %>%
  left_join(., child_lies_tab2) %>%
  ungroup() %>%
  mutate(cond = fct_recode(cond, 
                           "Control (no reason for dishonesty)" = "cont",
                           "Experimental (politeness reasons)" = "expt"
                           )) %>%
  mutate(agebin = fct_recode(agebin,
                             "5-6-yr" = "6",
                             "7-8-yr" = "8"
                             )) %>%
  rename('Total N'=n) %>%
  rename(Condition = cond) %>%
  rename(Sample = sample) %>%
  rename('Age group' = agebin) %>%
  rename('Mean age (years)' = mean, "SD age (years)" = sd)


# apa_table(child_lies_tab, caption = "Participant demographic information.", align = c(rep("l", 6)) %>%
#    column_spec(column = 5, width = "3cm")
   
child_lies_tab %>% 
  replace(is.na(.), "") %>%
  kable("latex", 
        booktabs = T, 
        caption = "Participant demographic information.",
        caption.short = "demographics") %>%
  kable_styling(latex_options = "scale_down") %>% 
  row_spec(row = 0, bold = TRUE) %>% 
  column_spec(column = 6, width = "2.2cm") %>% 
  column_spec(column = 7, width = "2.2cm") 

```
### Participants

We recruited parents and their children at Children's Discovery Museum of San Jose, and adults through Amazon's Mechanical Turk. We recruited two samples: a first, *original* sample and a second, pre-registered *replication* sample. You can see the participant demographic information in Table\ \ref{tab:childInfSample}. 

We included training trials where children and adults were tested on the meanings of important keywords such as "nice", "mean", and "truth." For example, participants were asked: "Nicole gave her friend a gift. Was Nicole nice? Was Nicole mean?" We excluded participants who gave wrong answers on these trials, which led to exclusion of 2 child participants from the original sample. FIXME: adult excluded numbers.

### Stimuli and design

We presented stories in which some characters (*speakers*) were asked to give evaluative feedback on something bad that they just experienced (e.g., a yucky cookie that they tasted, or a boring game that they played).
There were two different *context conditions*: 
In the *experimental* condition, speakers were asked by listeners to comment on something that the listeners themselves had created, and so the speakers may be compelled to lie and hide the poor quality of the product in order to not hurt the listener's feelings.
For example, one story in the experimental condition read: "Look, this is Edward [the listener]!
One day, Edward decided to bake some cookies.
Edward brought his cookie to school and met his friend Mary [the speaker]. Edward said to his friend Mary, “Here, try my cookie!”
Mary tasted the cookie,
and she did not like the cookie at all — she thought the cookie tasted yucky!
Edward asked Mary, “Mary, how did you like my cookie?” Mary told Edward, “Edward, your cookie was tasty.”"
In the *control* context condition, speakers were asked by listeners to comment on something that they stumbled upon, not what the listeners created (and thus had no reasons to lie about the quality of the product). 
The cookie story in the control condition read:
"Look, this is Mary!
One day, Mary saw a free cookie.
Mary said, “It’s a free cookie, I’ll try it!”
Mary tasted the cookie,
and she did not like the cookie at all — she thought the cookie tasted yucky!
Mary’s friend Edward also wanted to taste the cookie. Edward asked Mary, “Mary, how did you like the cookie?” Mary told Edward, “Edward, the cookie was tasty.”"
For the original sample, the conditions were between participants (i.e., each participant saw only one of the two conditions), whereas for the replication sample, the conditions were within (i.e., each participant saw both conditions).
Each story presented two episodes each about a different speaker, one who told a lie and the other who told the truth (*speaker type*). After presenting what each speaker decided to say, we presented three *question types*, asking participants to judge (1) whether the speaker told the truth; (2) whether the speaker was nice; and (3) whether the speaker was mean.
For the original sample, each participant heard two stories from the same condition (either experimental or control); for the replication sample, each participant heard four stories, two from each condition. The order of context conditions, speaker types and question types was counterbalanced across participants.

### Procedure

For child participants, the experimenter read the storybook with children in a room in a children's museum. 
They were first introduced to the storybook with simple stories to familiarize them with keywords like "nice," "mean," and "truth" (e.g., "Pam ate five cookies, but Pam told her mom a lie that she didn’t eat any cookie. Was Pam telling the truth?"). 
Then the experimenter read two (original) or four (replication) stories. 
While reading each episode, experimenters checked for the participants' comprehension twice by asking whether the speaker liked the product (e.g., "So did Sally like the cookie or did she not like the cookie?") and what the speaker told the listener ("So what did Sally tell Edward again?"). If the participant gave an incorrect answer to these comprehension check questions, the experimenter said "let's think about that one more time," and repeated the story.

For adult participants, we presented the same stories that children heard in an online task.

## Results and Discussion

```{r childInfPlot}
d_plot <- d %>%
  # filter(trial %in% c(1, 2, 3, 4)) %>%
  filter(qkind %in% c("nice", "mean", "truth")) %>%
  # filter(qkind %in% c("nice", "mean")) %>%
  # filter(qkind != "truth") %>%
  mutate(qkind = fct_relevel(qkind, "truth", "nice", "mean")) %>%
  mutate(qkind = fct_recode(qkind, 
                            "telling the truth" = "truth"
                            )) %>%
  mutate(speaker = fct_recode(speaker,
                            "judgments for honest speaker" = "honest",
                            "judgments for dishonest speaker" = "polite"
                            )) %>%
  mutate(cond = fct_recode(cond, 
                           "no apparent reason \nfor dishonesty" = "cont",
                           "politeness reasons" = "expt"
                           )) %>%
  mutate(agebin = fct_recode(agebin,
                             "5-6-yr" = "6",
                             "7-8-yr" = "8"
                             )) %>%
  filter(answer == "1" | answer == "0") %>%
  mutate(answer = as.numeric(as.character(answer)))

plot <- d_plot %>%
  group_by(sample, agebin, qkind, cond, speaker, subid) %>%
  summarise(answer = mean(answer, na.rm=T)) %>%
  group_by(sample, agebin, qkind, cond, speaker) %>%
  multi_boot_standard(col="answer") %>%
  rename(answer = mean) %>%
  # ggplot(., aes(x=agebin, y=answer, col=cond, shape=sample, alpha=sample)) +
  ggplot(., aes(x=agebin, y=answer, col=cond, shape=sample)) +
  # geom_jitter(height=.05) +
  geom_smooth() +
  geom_point(aes(size=.6), position=position_dodge(width=.3), stat = "identity") +
  geom_linerange(aes(ymin=ci_lower, ymax=ci_upper), position=position_dodge(width=.3), stat = "identity") +
  facet_grid(qkind~speaker) + 
  theme_few() +
  theme(legend.position = "bottom", legend.title = element_blank()) +
  geom_hline(aes(yintercept=0.5), linetype="dashed") +
  scale_colour_ptol() + 
  # scale_alpha_manual(values=c(0,1)) +
  # ggtitle("Expt 1: Judgments for honest vs. polite speaker") +
  ylab("Proportion \"yes [the speaker was _____]\"") +
  xlab("Age") +
  ylim(-0.1,1.1) +
  scale_y_continuous(breaks=seq(0,1,.5)) +
  guides(size=FALSE)

# ggsave(here("age_by_cond_bothSamples_truth.pdf"), width=6, height=5)
ggsave(plot, file=here::here(child_lies_image_path, "trupol_plot.png"), width=5, height=5)
```

```{r figTrupolResultsPlacement, fig.env = "figure*", fig.pos = "p", fig.width=7, fig.height=5, fig.align = "center", set.cap.width=T, num.cols.cap=2, fig.cap = "Speaker judgments by different age groups (x-axis) for the honest speaker (left column) and the dishonest speaker (right), in different contexts (colors). Rows represent question types (e.g., Was Sally telling the truth?), and y-axis represents proportion saying \`\`yes\" to the question. Shapes represent original (circles) vs. replication samples (triangles). "}
png::readPNG(here::here(child_lies_image_path, "trupol_plot.png")) %>%
  grid::grid.raster()
```

### Truth-telling

```{r stat_truth}
ms_stat <- d %>%
  filter(qkind == "nice" | qkind == "mean" | qkind == "truth") %>%
  filter(!is.na(agebin)) %>%
  filter(cond == "expt") %>%
  mutate(answer = as.numeric(as.character(answer))) %>%
  select(sample, trial, age, agebin, speaker, qkind, subid, answer)

lmer_truth <- glmer(data=filter(ms_stat, qkind == "truth"), family=binomial, answer ~ sample + agebin * speaker + (1 | subid))

truth.speaker.beta <- round(summary(lmer_truth)$coef[4], 2)
```

```{r truthsummarytab, echo = F, results = 'asis'}
truth.tab <- as.data.frame(summary(lmer_truth)$coef)

truth.tab$Predictor <- c("Intercept",
                      "8-year-olds",
                      "Adults",
                      "Polite speaker",
                      "8-year-olds * Polite speaker",
                      "Adults * Polite speaker")
rownames(truth.tab) <- NULL
truth.tab <- truth.tab[,c(5,1:3)]
names(truth.tab)[4] <- c("$z$ value")

print(xtable(truth.tab,
             align = c("l","l","r","r", "r"),
             label = "tab:truth_tab",
             caption = "Predictor estimates with standard errors and significance information for a generalized linear mixed-effects model predicting speaker truth-telling judgments"),
      include.rownames=FALSE,hline.after=c(0,nrow(truth.tab)),
      sanitize.text.function=function(x){x},
      caption.placement = 'bottom', 
      table.placement = "h",
      comment = F)
```

Across all age groups, adults and children correctly judged the honest speaker to be telling the truth, and the dishonest speaker as not telling the truth. A generalized linear mixed-effects model predicting truth-telling judgment based on age and speaker type showed a significant main effect of speaker type ($\beta$ = `r truth.speaker.beta`, $p <.001$). There was no main effect of age, and no interaction between age and speaker type. Thus, even the youngest group of participants we tested were able to correctly reason that the honest speaker was telling the truth, whereas the polite speaker was lying.

### Niceness

```{r stat_nice}
lmer_nice <- glmer(data=filter(ms_stat, qkind == "nice"), family=binomial, answer ~ sample + agebin * speaker + (1 | subid))

nice.speaker.beta <- round(summary(lmer_nice)$coef[4], 2)
```

```{r nicesummarytab, echo = F, results = 'asis'}
nice.tab <- as.data.frame(summary(lmer_nice)$coef)

nice.tab$Predictor <- c("Intercept",
                      "8-year-olds",
                      "Adults",
                      "Polite speaker",
                      "8-year-olds * Polite speaker",
                      "Adults * Polite speaker")
rownames(nice.tab) <- NULL
nice.tab <- nice.tab[,c(5,1:3)]
names(nice.tab)[4] <- c("$z$ value")

print(xtable(nice.tab,
             align = c("l","l","r","r", "r"),
             label = "tab:nice_tab",
             caption = "Predictor estimates with standard errors and significance information for a generalized linear mixed-effects model predicting speaker niceness judgments"),
      include.rownames=FALSE,hline.after=c(0,nrow(nice.tab)),
      sanitize.text.function=function(x){x},
      caption.placement = 'bottom', 
      table.placement = "h",
      comment = F)
```

```{r stat_nice_age_cont}
lmer_nice_age <- glmer(data=filter(ms_stat, qkind == "nice"), family=binomial, answer ~ sample + age * speaker + (1 | subid))

nice.age.speaker.beta <- round(summary(lmer_nice_age)$coef[4], 2)
```

### Meanness

```{r stat_mean}
lmer_mean <- glmer(data=filter(ms_stat, qkind == "mean"), family=binomial, answer ~ sample + agebin * speaker + (1 | subid))

mean.speaker.beta <- round(summary(lmer_mean)$coef[4], 2)
```

```{r meansummarytab, echo = F, results = 'asis'}
mean.tab <- as.data.frame(summary(lmer_mean)$coef)

mean.tab$Predictor <- c("Intercept",
                      "8-year-olds",
                      "Adults",
                      "Polite speaker",
                      "8-year-olds * Polite speaker",
                      "Adults * Polite speaker")
rownames(mean.tab) <- NULL
mean.tab <- mean.tab[,c(5,1:3)]
names(mean.tab)[4] <- c("$z$ value")

print(xtable(mean.tab,
             align = c("l","l","r","r", "r"),
             label = "tab:mean_tab",
             caption = "Predictor estimates with standard errors and significance information for a generalized linear mixed-effects model predicting speaker meanness judgments"),
      include.rownames=FALSE,hline.after=c(0,nrow(nice.tab)),
      sanitize.text.function=function(x){x},
      caption.placement = 'bottom', 
      table.placement = "h",
      comment = F)
```

```{r stat_mean_age_cont}
lmer_mean_age <- glmer(data=filter(ms_stat, qkind == "mean"), family=binomial, answer ~ sample + age * speaker + (1 | subid))

mean.age.speaker.beta <- round(summary(lmer_mean_age)$coef[4], 2)
```